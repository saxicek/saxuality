---
layout: post
title: Querying DATA_DEFAULT from Oracle data dictionary
date: '2012-04-04T15:11:00.000+02:00'
author: Libor Nenad√°l
tags: 
modified_time: '2013-04-16T18:37:32.510+02:00'
blogger_id: tag:blogger.com,1999:blog-17453343.post-1742810753703192289
blogger_orig_url: http://saxuality.blogspot.com/2012/04/querying-datadefault-from-oracle-data.html
---

<div dir="ltr" style="text-align: left;" trbidi="on">There is one unfortunate thing in Oracle DB - although data type LONG is obsoleted and should not be used, it is being used by Oracle data dictionary. This data type lacks of a proper support and work with it is a nightmare. This example focuses on retrieval of DEFAULT of a table column. Should be easy, right? But no, it is not. I did not find any sensible solution for this, you have to implement a function, that will retrieve the value for you. <a href="http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:426318778291">AskTOM page</a> helped with the generic function definition, I rewrote it to fit my purpose. Here it is:<br /><br /><pre class="brush: java">CREATE OR REPLACE FUNCTION data_default<br />(<br />  p_table_name  VARCHAR2<br /> ,p_column_name VARCHAR2<br />) RETURN VARCHAR2 AS<br />  l_query     VARCHAR2(1000) := 'select data_default from user_tab_cols where table_name = :tn and column_name = :cn';<br />  l_from_byte NUMBER := 0;<br />  l_for_bytes NUMBER := 1000;<br />  l_cursor    INTEGER DEFAULT dbms_sql.open_cursor;<br />  l_long_val  LONG;<br />  l_buflen    INTEGER;<br />  l_ignore    NUMBER;<br />BEGIN<br />  dbms_sql.parse(l_cursor, l_query, dbms_sql.native);<br /><br />  dbms_sql.bind_variable(l_cursor, ':tn', p_table_name);<br />  dbms_sql.bind_variable(l_cursor, ':cn', p_column_name);<br /><br />  dbms_sql.define_column_long(l_cursor, 1);<br />  l_ignore := dbms_sql.execute(l_cursor);<br /><br />  IF (dbms_sql.fetch_rows(l_cursor) &gt; 0) THEN<br />    dbms_sql.column_value_long(c            =&gt; l_cursor<br />                              ,position     =&gt; 1<br />                              ,length       =&gt; l_for_bytes<br />                              ,offset       =&gt; l_from_byte<br />                              ,VALUE        =&gt; l_long_val<br />                              ,value_length =&gt; l_buflen);<br />  END IF;<br /><br />  dbms_sql.close_cursor(l_cursor);<br /><br />  RETURN l_long_val;<br />EXCEPTION<br />  WHEN OTHERS THEN<br />    IF dbms_sql.is_open(l_cursor) THEN<br />      dbms_sql.close_cursor(l_cursor);<br />    END IF;<br />    RAISE;<br />END data_default;<br />/<br /></pre><br />Now you can use the function to query the data dictionary:<br /><br /><pre class="brush: sql"><br />SELECT table_name<br />      ,column_name<br />      ,data_type<br />      ,data_default(table_name, column_name)<br />  FROM user_tab_cols<br />/<br /></pre></div><script type="text/javascript">SyntaxHighlighter.highlight();</script>