---
layout: post
title: Set sequence to specified value
date: '2007-10-17T12:47:00.000+02:00'
author: sax
tags: 
modified_time: '2007-10-17T17:38:34.047+02:00'
blogger_id: tag:blogger.com,1999:blog-17453343.post-3934454001445082275
blogger_orig_url: http://saxuality.blogspot.com/2007/10/set-sequence-to-specified-value.html
---

This procedure comes handy when you migrate data to your tables with primary keys set and than you need to fix sequences values so that next table insert won't fail.<br /><span style="font-weight: bold;"><br />IMPORTANT:</span> Process uses <span style="font-family: courier new;">alter sequence</span> call so it raises implicit commit. Take it into consideration when you use it.<br /><br />The first procedure just set current sequence value:<br /><code><pre><br />procedure set_sequence(<br />  p_sequence_name       user_sequences.sequence_name%TYPE,<br />  p_last_number         user_sequences.last_number%TYPE<br />) is<br />  v_increment_by    user_sequences.increment_by%TYPE;<br />  v_current_seq     user_sequences.last_number%TYPE;<br />  v_min_value       user_sequences.min_value%TYPE;<br />  v_temp_value      NUMBER;<br />begin<br />  -- get increment_by value and current sequence value<br />  select increment_by<br />        ,last_number - increment_by<br />        ,min_value<br />    into v_increment_by<br />        ,v_current_seq<br />        ,v_min_value<br />    from user_sequences<br />   where sequence_name = UPPER(p_sequence_name);<br /><br />  if (p_last_number > v_min_value) and (p_last_number <> v_current_seq) then<br />    -- alter current sequence value<br />    execute immediate 'alter sequence '||p_sequence_name||' increment by '||to_char(p_last_number - v_current_seq);<br /><br />    execute immediate 'select '||p_sequence_name||'.nextval from dual' into v_temp_value;<br /><br />    execute immediate 'alter sequence '||p_sequence_name||' increment by '||to_char(v_increment_by);<br />  end if;<br />end set_sequence;<br /></pre></code><br />Second procedure just find the maximum value of specified table column and sets assigned sequence value to it:<br /><code><pre><br />procedure set_sequence_by_column(<br />  p_sequence_name       user_sequences.sequence_name%TYPE,<br />  p_table_name          user_tables.table_name%TYPE,<br />  p_column_name         user_tab_columns.column_name%TYPE<br />) is<br />  v_current_max     NUMBER;<br />begin<br />  -- find maximum value in specified table column<br />  execute immediate 'select max('||p_column_name||') from '||p_table_name<br />     into v_current_max;<br /><br />  if v_current_max is not null then<br />    set_sequence(p_sequence_name, v_current_max);<br />  end if;<br />end set_sequence_by_column;<br /></pre></code><br />And that's it! :-)